<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Simulate transmission chains using a branching process — chain_sim • bpmodels</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate transmission chains using a branching process — chain_sim"><meta property="og:description" content="chain_sim() is a stochastic simulator for generating
transmission chain data with key inputs such as the offspring distribution
and serial interval distribution."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bpmodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.9999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/projecting_incidence.html">Projecting infectious disease incidence: a COVID-19 example</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/epiverse-trace/bpmodels/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Simulate transmission chains using a branching process</h1>
    <small class="dont-index">Source: <a href="https://github.com/epiverse-trace/bpmodels/blob/HEAD/R/simulate.r" class="external-link"><code>R/simulate.r</code></a></small>
    <div class="hidden name"><code>chain_sim.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>chain_sim()</code> is a stochastic simulator for generating
transmission chain data with key inputs such as the offspring distribution
and serial interval distribution.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">chain_sim</span><span class="op">(</span></span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">offspring</span>,</span>
<span>  stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"length"</span><span class="op">)</span>,</span>
<span>  infinite <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  tree <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">serial</span>,</span>
<span>  t0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tf <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>n</dt>
<dd><p>Number of simulations to run.</p></dd>


<dt>offspring</dt>
<dd><p>Offspring distribution: a character string corresponding to
the R distribution function (e.g., "pois" for Poisson, where
<code><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></code> is the R function to generate Poisson random numbers)</p></dd>


<dt>stat</dt>
<dd><p>String; Statistic to calculate. Can be one of:</p><ul><li><p>"size": the total number of offspring.</p></li>
<li><p>"length": the total number of ancestors.</p></li>
</ul></dd>


<dt>infinite</dt>
<dd><p>A size or length above which the simulation results
should be set to <code>Inf</code>. Defaults to <code>Inf</code>, resulting in no results
ever set to <code>Inf</code></p></dd>


<dt>tree</dt>
<dd><p>Logical. Should the transmission tree be returned? Defaults
to <code>FALSE</code>.</p></dd>


<dt>serial</dt>
<dd><p>The serial interval generator function; the name of a
user-defined named or anonymous function with only one argument <code>n</code>,
representing the number of serial intervals to generate.</p></dd>


<dt>t0</dt>
<dd><p>Start time (if serial interval is given); either a single value
or a vector of length <code>n</code> (number of simulations) with initial times.
Defaults to 0.</p></dd>


<dt>tf</dt>
<dd><p>End time (if serial interval is given).</p></dd>


<dt>...</dt>
<dd><p>Parameters of the offspring distribution as required by R.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Either:</p><ul><li><p>A vector of sizes/lengths (if <code>tree == FALSE</code> OR serial
interval function not specified, since that implies
<code>tree == FALSE</code>), or</p></li>
<li><p>a data frame with
columns <code>n</code> (simulation ID), <code>time</code> (if the serial interval is given) and
(if <code>tree == TRUE</code>), <code>id</code> (a unique ID within each simulation for
each individual element of the chain), <code>ancestor</code> (the ID of the
ancestor of each element), and <code>generation</code>.</p></li>
</ul></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>chain_sim()</code> either returns a vector or a data.frame. The output is
either a vector if <code>serial</code> is not provided, which automatically sets
<code>tree = FALSE</code>, or a <code>data.frame</code>, which means that <code>serial</code> was
provided as a function. When <code>serial</code> is provided, it means
<code>tree = TRUE</code> automatically. However, setting <code>tree = TRUE</code>
would require providing a function for <code>serial</code>.</p>
    </div>
    <div id="the-serial-interval-serial-">
    <h2>The serial interval (<code>serial</code>):</h2>
    
<div class="section">
<h3 id="assumptions-disambiguation">Assumptions/disambiguation<a class="anchor" aria-label="anchor" href="#assumptions-disambiguation"></a></h3>


<p>In epidemiology, the generation interval is the duration between successive
infectious events in a chain of transmission. Similarly, the serial
interval is the duration between observed symptom onset times between
successive cases in a transmission chain. The generation interval is
often hard to observe because exact times of infection are hard to
measure hence, the serial interval is often used instead. Here, we
use the serial interval to represent what would normally be called the
generation interval, that is, the time between successive cases.</p>
</div>

<div class="section">
<h3 id="specifying-serial-in-chain-sim-">Specifying <code>serial</code> in <code>chain_sim()</code><a class="anchor" aria-label="anchor" href="#specifying-serial-in-chain-sim-"></a></h3>


<p><code>serial</code> must be specified as a named or
<a href="https://en.wikipedia.org/wiki/Anonymous_function#R" class="external-link">anonymous/inline/unnamed function</a> # nolint
with one argument.</p>
<p>If <code>serial</code> is specified, <code>chain_sim()</code> returns times of
infection as a column in the output. Moreover, specifying a function
for <code>serial</code> implies <code>tree = TRUE</code> and a tree of
infectors (<code>ancestor</code>) and infectees (<code>id</code>) will be generated in the output.</p>
<p>For example, assuming we want to specify the serial interval
generator as a random log-normally distributed variable with
<code>meanlog = 0.58</code> and <code>sdlog = 1.58</code>, we could define a named function,
let's call it "serial_interval", with only one argument representing the
number of serial intervals to sample:
<code>serial_interval &lt;- function(n){rlnorm(n, 0.58, 1.38)}</code>,
and assign the name of the function to serial in <code>chain_sim()</code> like so
<code>chain_sim(..., serial = serial_interval)</code>,
where <code>...</code> are the other arguments to <code>chain_sim()</code>. Alternatively, we
could assign an anonymous function to serial in the <code>chain_sim()</code> call
like so <code>chain_sim(..., serial = function(n){rlnorm(n, 0.58, 1.38)})</code>,
where <code>...</code> are the other arguments to <code>chain_sim()</code>.</p>
</div>

    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Sebastian Funk, James M. Azam</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Specifying no `serial` and `tree == FALSE` (default) returns a vector</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">chain_sim</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, offspring <span class="op">=</span> <span class="st">"pois"</span>, stat <span class="op">=</span> <span class="st">"size"</span>, lambda <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>tree <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 1 2 4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specifying `serial` without specifying `tree` will set `tree = TRUE`</span></span></span>
<span class="r-in"><span><span class="co"># internally.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We'll first define the serial function</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">serial_interval</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n</span>, meanlog <span class="op">=</span> <span class="fl">0.58</span>, sdlog <span class="op">=</span> <span class="fl">1.58</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu">chain_sim</span><span class="op">(</span></span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">5</span>, offspring <span class="op">=</span> <span class="st">"pois"</span>, lambda <span class="op">=</span> <span class="fl">0.5</span>, stat <span class="op">=</span> <span class="st">"length"</span>,</span></span>
<span class="r-in"><span>  infinite <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  serial <span class="op">=</span> <span class="va">serial_interval</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    n id ancestor generation       time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  3  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  5  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  2  2        1          2  0.1237492</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  4  2        1          2 12.6594440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  5  2        1          2  1.5035572</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  5  3        1          2  1.4840246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 5  4        2          3  1.6201477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 5  5        4          4 13.9750044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 5  6        4          4  4.7736253</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 5  7        5          5 16.1023578</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 5  8        6          5  5.5157567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 5  9        7          6 20.0243658</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 5 10        7          6 16.1822358</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 5 11        8          6 10.9251791</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specifying `serial` and `tree = FALSE` will throw an error</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">chain_sim</span><span class="op">(</span></span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">10</span>, serial <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">3</span>, offspring <span class="op">=</span> <span class="st">"pois"</span>, lambda <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  infinite <span class="op">=</span> <span class="fl">10</span>, tree <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Sebastian Funk, Flavio Finger, James M. Azam.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

