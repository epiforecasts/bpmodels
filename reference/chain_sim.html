<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Simulate transmission chains using a branching process — chain_sim • bpmodels</title><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Simulate transmission chains using a branching process — chain_sim"><meta name="description" content="chain_sim() is a stochastic simulator for generating
transmission chain data with key inputs such as the offspring distribution
and serial interval distribution."><meta property="og:description" content="chain_sim() is a stochastic simulator for generating
transmission chain data with key inputs such as the offspring distribution
and serial interval distribution."><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-XZ471458FQ');
</script></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">
    <a href="https://epiverse-trace.github.io/" class="external-link"><img src="https://epiverse-trace.github.io/blueprints/logo_white.svg" id="logo" alt="Epiverse-TRACE"></a>
    <a class="navbar-brand me-2" href="../index.html">bpmodels</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.3.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/bpmodels.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Theory &amp; literature</h6></li>
    <li><a class="dropdown-item" href="../articles/theoretical_background.html">Theoretical background for bpmodels</a></li>
    <li><a class="dropdown-item" href="../articles/branching_process_literature.html">Literature on branching process applications</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Modelling</h6></li>
    <li><a class="dropdown-item" href="../articles/projecting_incidence.html">Projecting infectious disease incidence: a COVID-19 example</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/epiforecasts/bpmodels/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Simulate transmission chains using a branching process</h1>
      <small class="dont-index">Source: <a href="https://github.com/epiforecasts/bpmodels/blob/v0.3.2/R/simulate.r" class="external-link"><code>R/simulate.r</code></a></small>
      <div class="d-none name"><code>chain_sim.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>chain_sim()</code> is a stochastic simulator for generating
transmission chain data with key inputs such as the offspring distribution
and serial interval distribution.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">chain_sim</span><span class="op">(</span></span>
<span>  <span class="va">n</span>,</span>
<span>  <span class="va">offspring</span>,</span>
<span>  stat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"size"</span>, <span class="st">"length"</span><span class="op">)</span>,</span>
<span>  infinite <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  tree <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">serial</span>,</span>
<span>  t0 <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  tf <span class="op">=</span> <span class="cn">Inf</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>Number of simulations to run.</p></dd>


<dt id="arg-offspring">offspring<a class="anchor" aria-label="anchor" href="#arg-offspring"></a></dt>
<dd><p>Offspring distribution: a character string corresponding to
the R distribution function (e.g., "pois" for Poisson, where
<code><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></code> is the R function to generate Poisson random numbers)</p></dd>


<dt id="arg-stat">stat<a class="anchor" aria-label="anchor" href="#arg-stat"></a></dt>
<dd><p>String; Statistic to calculate. Can be one of:</p><ul><li><p>"size": the total number of offspring.</p></li>
<li><p>"length": the total number of ancestors.</p></li>
</ul></dd>


<dt id="arg-infinite">infinite<a class="anchor" aria-label="anchor" href="#arg-infinite"></a></dt>
<dd><p>A size or length above which the simulation results
should be set to <code>Inf</code>. Defaults to <code>Inf</code>, resulting in no results
ever set to <code>Inf</code></p></dd>


<dt id="arg-tree">tree<a class="anchor" aria-label="anchor" href="#arg-tree"></a></dt>
<dd><p>Logical. Should the transmission tree be returned? Defaults
to <code>FALSE</code>.</p></dd>


<dt id="arg-serial">serial<a class="anchor" aria-label="anchor" href="#arg-serial"></a></dt>
<dd><p>The serial interval generator function; the name of a
user-defined named or anonymous function with only one argument <code>n</code>,
representing the number of serial intervals to generate.</p></dd>


<dt id="arg-t-">t0<a class="anchor" aria-label="anchor" href="#arg-t-"></a></dt>
<dd><p>Start time (if serial interval is given); either a single value
or a vector of length <code>n</code> (number of simulations) with initial times.
Defaults to 0.</p></dd>


<dt id="arg-tf">tf<a class="anchor" aria-label="anchor" href="#arg-tf"></a></dt>
<dd><p>End time (if serial interval is given).</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Parameters of the offspring distribution as required by R.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Either:</p><ul><li><p>A vector of sizes/lengths (if <code>tree == FALSE</code> OR serial
interval function not specified, since that implies
<code>tree == FALSE</code>), or</p></li>
<li><p>a data frame with
columns <code>n</code> (simulation ID), <code>time</code> (if the serial interval is given) and
(if <code>tree == TRUE</code>), <code>id</code> (a unique ID within each simulation for
each individual element of the chain), <code>ancestor</code> (the ID of the
ancestor of each element), and <code>generation</code>.</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code>chain_sim()</code> either returns a vector or a data.frame. The output is
either a vector if <code>serial</code> is not provided, which automatically sets
<code>tree = FALSE</code>, or a <code>data.frame</code>, which means that <code>serial</code> was
provided as a function. When <code>serial</code> is provided, it means
<code>tree = TRUE</code> automatically. However, setting <code>tree = TRUE</code>
would require providing a function for <code>serial</code>.</p>
    </div>
    <div class="section level2">
    <h2 id="the-serial-interval-serial-">The serial interval (<code>serial</code>):<a class="anchor" aria-label="anchor" href="#the-serial-interval-serial-"></a></h2>

<div class="section">
<h3 id="assumptions-disambiguation">Assumptions/disambiguation<a class="anchor" aria-label="anchor" href="#assumptions-disambiguation"></a></h3>


<p>In epidemiology, the generation interval is the duration between successive
infectious events in a chain of transmission. Similarly, the serial
interval is the duration between observed symptom onset times between
successive cases in a transmission chain. The generation interval is
often hard to observe because exact times of infection are hard to
measure hence, the serial interval is often used instead. Here, we
use the serial interval to represent what would normally be called the
generation interval, that is, the time between successive cases.</p>
</div>

<div class="section">
<h3 id="specifying-serial-in-chain-sim-">Specifying <code>serial</code> in <code>chain_sim()</code><a class="anchor" aria-label="anchor" href="#specifying-serial-in-chain-sim-"></a></h3>


<p><code>serial</code> must be specified as a named or
<a href="https://en.wikipedia.org/wiki/Anonymous_function#R" class="external-link">anonymous/inline/unnamed function</a> # nolint
with one argument.</p>
<p>If <code>serial</code> is specified, <code>chain_sim()</code> returns times of
infection as a column in the output. Moreover, specifying a function
for <code>serial</code> implies <code>tree = TRUE</code> and a tree of
infectors (<code>ancestor</code>) and infectees (<code>id</code>) will be generated in the output.</p>
<p>For example, assuming we want to specify the serial interval
generator as a random log-normally distributed variable with
<code>meanlog = 0.58</code> and <code>sdlog = 1.58</code>, we could define a named function,
let's call it "serial_interval", with only one argument representing the
number of serial intervals to sample:
<code>serial_interval &lt;- function(n){rlnorm(n, 0.58, 1.38)}</code>,
and assign the name of the function to serial in <code>chain_sim()</code> like so
<code>chain_sim(..., serial = serial_interval)</code>,
where <code>...</code> are the other arguments to <code>chain_sim()</code>. Alternatively, we
could assign an anonymous function to serial in the <code>chain_sim()</code> call
like so <code>chain_sim(..., serial = function(n){rlnorm(n, 0.58, 1.38)})</code>,
where <code>...</code> are the other arguments to <code>chain_sim()</code>.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Funk, James M. Azam</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Specifying no `serial` and `tree == FALSE` (default) returns a vector</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">chain_sim</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span>, offspring <span class="op">=</span> <span class="st">"pois"</span>, stat <span class="op">=</span> <span class="st">"size"</span>, lambda <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>tree <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1 2 1 2 4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specifying `serial` without specifying `tree` will set `tree = TRUE`</span></span></span>
<span class="r-in"><span><span class="co"># internally.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We'll first define the serial function</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">serial_interval</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/stats/Lognormal.html" class="external-link">rlnorm</a></span><span class="op">(</span><span class="va">n</span>, meanlog <span class="op">=</span> <span class="fl">0.58</span>, sdlog <span class="op">=</span> <span class="fl">1.58</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu">chain_sim</span><span class="op">(</span></span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">5</span>, offspring <span class="op">=</span> <span class="st">"pois"</span>, lambda <span class="op">=</span> <span class="fl">0.5</span>, stat <span class="op">=</span> <span class="st">"length"</span>,</span></span>
<span class="r-in"><span>  infinite <span class="op">=</span> <span class="fl">100</span>,</span></span>
<span class="r-in"><span>  serial <span class="op">=</span> <span class="va">serial_interval</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    n id ancestor generation       time</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1  1  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  2  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3  3  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4  4  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5  5  1       NA          1  0.0000000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6  2  2        1          2  0.1237492</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7  4  2        1          2 12.6594440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8  5  2        1          2  1.5035572</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9  5  3        1          2  1.4840246</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10 5  4        2          3  1.6201477</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11 5  5        4          4 13.9750044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12 5  6        4          4  4.7736253</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13 5  7        5          5 16.1023578</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14 5  8        6          5  5.5157567</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15 5  9        7          6 20.0243658</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 16 5 10        7          6 16.1822358</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17 5 11        8          6 10.9251791</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Specifying `serial` and `tree = FALSE` will throw a warning saying that</span></span></span>
<span class="r-in"><span><span class="co"># `tree` was set to `TRUE` internally.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu">chain_sim</span><span class="op">(</span></span></span>
<span class="r-in"><span>  n <span class="op">=</span> <span class="fl">10</span>, serial <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fl">3</span>, offspring <span class="op">=</span> <span class="st">"pois"</span>, lambda <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  infinite <span class="op">=</span> <span class="fl">10</span>, tree <span class="op">=</span> <span class="cn">FALSE</span></span></span>
<span class="r-in"><span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by James M. Azam, Flavio Finger, Sebastian Funk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

